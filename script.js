// Carregar Participantes
participantes = [
    {
        "nome": "Ana Livia",
        "nomeCompleto": "Ana Livia Matos Muniz",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "ana.jpg"
    },
    {
        "nome": "Andrade",
        "nomeCompleto": "Matheus Andrade Barreto",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "andrade.jpg"
    },
    {
        "nome": "Barbosa",
        "nomeCompleto": "Samuel Barbosa e Silva",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "barbosa.jpg"
    },
    {
        "nome": "Bretherick",
        "nomeCompleto": "Daniel Ambrózio Bretherick Marques",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "bretherick.jpg"
    },
    {
        "nome": "Bronson",
        "nomeCompleto": "Giulio Bronson Siqueira de Oliveira",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "bronson.jpg"
    },
    {
        "nome": "Burin",
        "nomeCompleto": "Bruno Camacho Burin",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "burin.jpg"
    },
    {
        "nome": "Cangussú",
        "nomeCompleto": "Rafael Cangussú Ferreira",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "cangussú.jpg"
    },
    {
        "nome": "Caruso",
        "nomeCompleto": "João Pedro Francisco Caruso",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "caruso.jpg"
    },
    {
        "nome": "Cuadros",
        "nomeCompleto": "Daniel Batista Cuadros",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "cuadros.jpg"
    },
    {
        "nome": "Damitz",
        "nomeCompleto": "Alexander Damitz Pinheiro",
        "posto": "1º Ten",
        "curso": "CG",
        "opcao": "Ativa",
		"foto": "damitz.jpg"
    },
    {
        "nome": "Danon",
        "nomeCompleto": "Gustavo Ewbank Rodrigues Danon",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "danon.jpg"
    },
    {
        "nome": "Felipe Santos",
        "nomeCompleto": "Felipe Lins dos Santos",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "felipe.jpg"
    },
    {
        "nome": "Gomes",
        "nomeCompleto": "Fernando Victor Correa Lima Gomes",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "gomes.jpg"
    },
    {
        "nome": "Joseph Vieira",
        "nomeCompleto": "Joseph Inácio Vieira Oliveira Gomes",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "joseph.jpg"
    },
    {
        "nome": "Knöller",
        "nomeCompleto": "Felipe Knöller Nunes",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "knöller.jpg"
    },
    {
        "nome": "Mateus Lima",
        "nomeCompleto": "Mateus Lima Silveira",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "mateus.jpg"
    },
    {
        "nome": "Nascimento",
        "nomeCompleto": "Vítor Eduardo Pinheiro do Nascimento",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "nascimento.jpg"
    },
    {
        "nome": "Nóbrega",
        "nomeCompleto": "Gabriel Nóbrega de Brito Ramos",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "nóbrega.jpg"
    },
    {
        "nome": "Paixão",
        "nomeCompleto": "Renato da Paixão Alves",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "paixão.jpg"
    },
    {
        "nome": "Pamella",
        "nomeCompleto": "Pamella Atanes Silva",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Reserva",
		"foto": "pamella.jpg"
    },
    {
        "nome": "Pinafi",
        "nomeCompleto": "Lucas Pinafi Carvalho",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "pinafi.jpg"
    },
    {
        "nome": "Pontes",
        "nomeCompleto": "Rafael Pontes Tenório Lima",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "pontes.jpg"
    },
    {
        "nome": "Queiroz",
        "nomeCompleto": "Carlos Henricco Rabelo de Queiroz",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "queiroz.jpg"
    },
    {
        "nome": "Richard",
        "nomeCompleto": "Richard de Carvalho Gonçalves Mello",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "richard.jpg"
    },
    {
        "nome": "Timbó",
        "nomeCompleto": "Rafael Cavalcante Timbó",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "timbó.jpg"
    },
    {
        "nome": "Vasconcelos",
        "nomeCompleto": "Thiago Oliveira Jucá Vasconcelos",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "vasconcelos.jpg"
    },
    {
        "nome": "Viegas",
        "nomeCompleto": "Gabriel de Oliveira Viegas",
        "posto": "Al",
        "curso": "CFG",
        "opcao": "Ativa",
		"foto": "viegas.jpg"
    }
]

// Criar Cards
$.each(participantes, function (i, al) {
    var card = $("<div>").addClass("card").addClass(al.curso)
    var img = $("<img>").attr("src", "images/" + al.foto)
    var dados = $("<div>").addClass("dados")
    var nome = $("<h2>").text(al.posto + ' ' + al.nome)
    var nomeCompleto = $("<h3>").text(al.nomeCompleto)
    var ano = $("<h4>").text('4º Ano')
    var categoria = $("<p>").addClass("categoria")
    categoria.text(al.curso == 'CFG' ? 'CFG - ' + al.opcao : 'CG')
    categoria.hide()

    dados.append(nome).append(nomeCompleto).append(ano).append(categoria)
    card.append(img).append(dados)
    $("#participantes").append(card)
})

// Confirmar / Desmarcar Partipante
$(".card img").click(function () {
    $(this).toggleClass("active")
    $(this).parent().toggleClass("selected")
})

// Filtro
$("#select").change(function ()
{
    var filtro = $(this).val()

    if (filtro == "Todos")
        $(".card").show()
    else
    {
        $(".card").hide()
        $("p:contains('" + filtro + "')").parent().parent().show()
    }
})

// Ordenação
function sortNames(a, b)
{
    var categoriaA = a.categoria.toUpperCase()
    var categoriaB = b.categoria.toUpperCase()
    if (categoriaA < categoriaB) return -1
    if (categoriaA > categoriaB) return 1

    var nomeA = a.nomeCompleto.toUpperCase()
    var nomeB = b.nomeCompleto.toUpperCase()
    if (nomeA < nomeB) return -1
    if (nomeA > nomeB) return 1

    return 0;
}

// Exportação CSV
$("#exportar").click(function () {
    var participantes = []
    var naoParticipantes = []

    $(".card").each(function () {
        var nome = $(this).find("h2").text()
        var nomeCompleto = $(this).find("h3").text()
        var categoria = $(this).find("p").text()

        if ($(this).hasClass("selected"))
            participantes.push({ categoria: categoria, nome: nome, nomeCompleto: nomeCompleto })
        else
            naoParticipantes.push({ categoria: categoria, nome: nome, nomeCompleto: nomeCompleto })
    })

    participantes.sort((a, b) => sortNames(a, b))
    naoParticipantes.sort((a, b) => sortNames(a, b))

    var participantesCSV = "Participante;Categoria;Nome de Guerra;Nome Completo\n"

    $.each(participantes, (i, al) => {
        participantesCSV += `Sim;${al.categoria};${al.nome};${al.nomeCompleto}\n`
    })

    $.each(naoParticipantes, (i, al) => {
        participantesCSV += `Não;${al.categoria};${al.nome};${al.nomeCompleto}\n`
    })

    var csvData = "data:text/csvcharset=utf-8," + encodeURIComponent(participantesCSV)
    var link = $("<a>").attr("href", csvData).attr("download", "participantes.csv")
    link[0].click()
})